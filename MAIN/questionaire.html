<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Builder</title>
    <link rel="stylesheet" href="questionaire.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

</head>
<body>



    <div class="tip-banner">
        <div class="tip-banner-green-bar"></div>
        <p class="tip-banner-text">
            <span class="tip-banner-content">
                <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#002b7f"><path d="M480-280q17 0 28.5-11.5T520-320q0-17-11.5-28.5T480-360q-17 0-28.5 11.5T440-320q0 17 11.5 28.5T480-280Zm0-160q17 0 28.5-11.5T520-480v-160q0-17-11.5-28.5T480-680q-17 0-28.5 11.5T440-640v160q0 17 11.5 28.5T480-440Zm0 360q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Z"/></svg>
                <span class="text">Consider creating an assessment with at least 25 or more questions to ensure its overall accuracy and validity.</span>
            </span>
        </p>
    </div>




    <div class="form-header">
        <div class="green-bar"></div>
        <div class="header-content">
            <input type="text" class="form-title" placeholder="Untitled Form">
            <input type="text" class="form-description" placeholder="Form Description">
        </div>
    </div>

    
    <div id="questionsContainer">
        <!-- Initial question block -->
        <div class="question-block">
            <div class="question-header">
                <input type="text" class="question-text" placeholder="Untitled Question">
                <div class="dropdown-container">
                    <select class="question-difficulty">
                        <option value="basic">Basic</option>
                        <option value="intermediate">Intermediate</option>
                        <option value="difficult">Difficult</option>
                    </select>
                    <select class="question-type">
                        <option value="multiple-choice">Multiple Choice</option>
                        <option value="checkbox">Checkboxes</option>
                        <option value="paragraph">Paragraph</option>
                    </select>
                </div>
            </div>
            
            <div class="options-container">
                <div class="option-container">
                    <div class="option-wrapper">
                        <div class="option-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#2e3849">
                                <path d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/>
                            </svg>
                        </div>
                        <input type="text" class="option-text" placeholder="Option 1">
                    </div>
                    <div class="correct-answer">
                        <label class="switch small">
                            <input type="checkbox" class="correct-toggle">
                            <span class="slider small"></span>
                        </label>
                        <span class="correct-label">Correct Answer</span>
                    </div>
                </div>
            </div>
            
            <div class="option-actions">
                <div class="add-option" onclick="addOption(this)">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#666666" style="margin-right: 8px;">
                        <path d="M440-440H240q-17 0-28.5-11.5T200-480q0-17 11.5-28.5T240-520h200v-200q0-17 11.5-28.5T480-760q17 0 28.5 11.5T520-720v200h200q17 0 28.5 11.5T760-480q0 17-11.5 28.5T720-440H520v200q0 17-11.5 28.5T480-200q-17 0-28.5-11.5T440-240v-200Z"/>
                    </svg>
                    Add option
                </div>
                <div class="remove-option" onclick="removeOption(this)">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#d93025" style="margin-right: 8px;"><path d="M280-120q-33 0-56.5-23.5T200-200v-520q-17 0-28.5-11.5T160-760q0-17 11.5-28.5T200-800h160q0-17 11.5-28.5T400-840h160q17 0 28.5 11.5T600-800h160q17 0 28.5 11.5T800-760q0 17-11.5 28.5T760-720v520q0 33-23.5 56.5T680-120H280Zm200-284l76 76q11 11 28 11t28-11q11-11 11-28t-11-28l-76-76 76-76q11-11 11-28t-11-28q-11-11-28-11t-28 11l-76 76-76-76q-11-11-28-11t-28 11q-11 11-11 28t11 28l76 76-76 76q-11 11-11 28t11 28q11 11 28 11t28-11l76-76Z"/></svg>
                    Remove option
                </div>
            </div>
    
            <div class="question-footer">
                <div class="footer-actions">
                    <button class="action-button" onclick="addQuestion()" title="Add">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#2e3849"><path d="M440-440v120q0 17 11.5 28.5T480-280q17 0 28.5-11.5T520-320v-120h120q17 0 28.5-11.5T680-480q0-17-11.5-28.5T640-520H520v-120q0-17-11.5-28.5T480-680q-17 0-28.5 11.5T440-640v120H320q-17 0-28.5 11.5T280-480q0 17 11.5 28.5T320-440h120Zm40 360q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>
                    </button>
                    <button class="action-button" onclick="duplicateQuestion()" title="Duplicate">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#2e3849">
                            <path d="M360-240q-33 0-56.5-23.5T280-320v-480q0-33 23.5-56.5T360-880h360q33 0 56.5 23.5T800-800v480q0 33-23.5 56.5T720-240H360Zm0-80h360v-480H360v480ZM200-80q-33 0-56.5-23.5T120-160v-520q0-17 11.5-28.5T160-720q17 0 28.5 11.5T200-680v520h400q17 0 28.5 11.5T640-120q0 17-11.5 28.5T600-80H200Zm160-240v-480 480Z"/>
                        </svg>
                    </button>
                    <button class="action-button" onclick="deleteQuestion()" title="Delete">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#2e3849">
                            <path d="M280-120q-33 0-56.5-23.5T200-200v-520q-17 0-28.5-11.5T160-760q0-17 11.5-28.5T200-800h160q0-17 11.5-28.5T400-840h160q17 0 28.5 11.5T600-800h160q17 0 28.5 11.5T800-760q0 17-11.5 28.5T760-720v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM400-280q17 0 28.5-11.5T440-320v-280q0-17-11.5-28.5T400-640q-17 0-28.5 11.5T360-600v280q0 17 11.5 28.5T400-280Zm160 0q17 0 28.5-11.5T600-320v-280q0-17-11.5-28.5T560-640q-17 0-28.5 11.5T520-600v280q0 17 11.5 28.5T560-280ZM280-720v520-520Z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="note-banner">
        <p class="note-banner-text">
            <span class="note-banner-content">
                <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#666666"><path d="M480-240q20 0 34-14t14-34q0-20-14-34t-34-14q-20 0-34 14t-14 34q0 20 14 34t34 14Zm-36-153h73q0-37 6.5-52.5T555-485q35-34 48.5-58t13.5-53q0-55-37.5-89.5T484-720q-51 0-88.5 27T343-620l65 27q9-28 28.5-43.5T482-652q28 0 46 16t18 42q0 23-15.5 41T496-518q-35 32-43.5 52.5T444-393Zm36 297q-79 0-149-30t-122.5-82.5Q156-261 126-331T96-480q0-80 30-149.5t82.5-122Q261-804 331-834t149-30q80 0 149.5 30t122 82.5Q804-699 834-629.5T864-480q0 79-30 149t-82.5 122.5Q699-156 629.5-126T480-96Z"/></svg>
                <span class="text">There is a set of difficulty level for each type of question. Each difficulty level will have a different timer based on its complexity.</span>
            </span>
        </p>
    </div>
    <div class="banner">
        <p class="banner-text">
            Create an in-depth <span style="color: #ff8c00; font-weight: 600" >assessment</span> for candidates applying to internship ads. Build now!
        </p>
        <button class="create-button">
            Publish <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#FFFFFF"><path d="M236.44-152.59q-34.46 0-59.16-24.69-24.69-24.7-24.69-59.16 0-34.47 24.69-59.02Q201.98-320 236.44-320q34.47 0 59.02 24.54Q320-270.91 320-236.44q0 34.46-24.54 59.16-24.55 24.69-59.02 24.69Zm0-243.82q-34.46 0-59.16-24.55-24.69-24.54-24.69-59.01 0-34.46 24.69-59.04 24.7-24.58 59.16-24.58 34.47 0 59.02 24.55Q320-514.5 320-480.03q0 34.46-24.54 59.04-24.55 24.58-59.02 24.58Zm0-243.59q-34.46 0-59.16-24.54-24.69-24.55-24.69-59.02 0-34.46 24.69-59.16 24.7-24.69 59.16-24.69 34.47 0 59.02 24.69Q320-758.02 320-723.56q0 34.47-24.54 59.02Q270.91-640 236.44-640Zm243.59 0q-34.46 0-59.04-24.54-24.58-24.55-24.58-59.02 0-34.46 24.55-59.16 24.54-24.69 59.01-24.69 34.46 0 59.04 24.69 24.58 24.7 24.58 59.16 0 34.47-24.55 59.02Q514.5-640 480.03-640Zm243.53 0q-34.47 0-59.02-24.54Q640-689.09 640-723.56q0-34.46 24.54-59.16 24.55-24.69 59.02-24.69 34.46 0 59.16 24.69 24.69 24.7 24.69 59.16 0 34.47-24.69 59.02Q758.02-640 723.56-640ZM480.03-396.41q-34.46 0-59.04-24.55-24.58-24.54-24.58-59.01 0-34.46 24.55-59.04 24.54-24.58 59.01-24.58 34.46 0 59.04 24.55 24.58 24.54 24.58 59.01 0 34.46-24.55 59.04-24.54 24.58-59.01 24.58Zm38.54 198.32v-65.04q0-9.2 3.47-17.53 3.48-8.34 10.2-15.06l208.76-208q9.72-9.76 21.59-14.09 11.88-4.34 23.76-4.34 12.95 0 24.8 4.86 11.85 4.86 21.55 14.57l37 37q8.67 9.72 13.55 21.6 4.88 11.87 4.88 23.75 0 12.2-4.36 24.41-4.36 12.22-14.07 21.94l-208 208q-6.69 6.72-15.04 10.07-8.36 3.36-17.55 3.36h-65.04q-19.16 0-32.33-13.17-13.17-13.17-13.17-32.33Zm270.17-185.67 34.61-36.61-37-37-35.61 35.61 38 38Z"/></svg>
        </button>
    </div>
    
    <script>    
    document.querySelector('.create-button').addEventListener('click', function(e) {
        e.preventDefault();
        // Collect form data
      // Collect form data
      const formData = {
            title: document.querySelector('.form-title').value || 'Untitled Form',
            description: document.querySelector('.form-description').value || '',
            questions: []
        };
        // Collect questions data
        // Collect questions data
        document.querySelectorAll('.question-block').forEach((questionBlock, index) => {
            const question = {
                title: questionBlock.querySelector('.question-text').value || 'Untitled Question',
                type: questionBlock.querySelector('.question-type').value,
                difficulty: questionBlock.querySelector('.question-difficulty').value,
                options: []
            };
            
            // Handle different question types
            if (question.type === 'paragraph') {
                const answerInput = questionBlock.querySelector('.answer-input');
                if (answerInput) {
                    question.paragraphAnswer = answerInput.value;
                }
            } else {
                // Collect options for multiple choice and checkbox questions
                questionBlock.querySelectorAll('.option-container').forEach((optionContainer, optionIndex) => {
                    question.options.push({
                        text: optionContainer.querySelector('.option-text').value || `Option ${optionIndex + 1}`,
                        isCorrect: optionContainer.querySelector('.correct-toggle').checked
                    });
                });
            }
            
            formData.questions.push(question);
        });
        
 
        fetch('questionaire_submit.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'formData=' + encodeURIComponent(JSON.stringify(formData))
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            if (data.success) {
                alert(data.message);
                window.location.href = 'index.php';
            } else {
                alert(data.message || 'Unknown error occurred');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error submitting form: ' + error.message);
        });
    });
    </script>

    <script>
        function deleteQuestion() {
            const questionBlock = event.target.closest('.question-block');
            const container = document.getElementById('questionsContainer');
            
            if (container.children.length > 1) {
                questionBlock.remove();
                updateDeleteButtons();
            }
        }

        function disableDeleteButton(button) {
            button.style.opacity = '0.5';
            button.style.cursor = 'not-allowed';
            button.style.pointerEvents = 'none';
        }

        function enableDeleteButton(button) {
            button.style.opacity = '1';
            button.style.cursor = 'pointer';
            button.style.pointerEvents = 'auto';
        }

        function updateDeleteButtons() {
            const container = document.getElementById('questionsContainer');
            const deleteButtons = container.querySelectorAll('.action-button[onclick="deleteQuestion()"]');
            
            if (container.children.length <= 1) {
                deleteButtons.forEach(button => disableDeleteButton(button));
            } else {
                deleteButtons.forEach(button => enableDeleteButton(button));
            }
        }

        function addQuestion() {
            const currentQuestion = event.target.closest('.question-block');
            const newQuestion = currentQuestion.cloneNode(true);
            
            // Reset to default values
            const questionType = newQuestion.querySelector('.question-type');
            const questionDifficulty = newQuestion.querySelector('.question-difficulty');
            questionType.value = 'multiple-choice';
            questionDifficulty.value = 'basic';
            
            // Reset the question text
            newQuestion.querySelector('.question-text').value = '';
            
            // Reset options container to only have one option
            const optionsContainer = newQuestion.querySelector('.options-container');
            const firstOption = optionsContainer.children[0].cloneNode(true);
            firstOption.querySelector('.option-text').value = '';
            firstOption.querySelector('.correct-toggle').checked = false;
            
            // Clear the options container and add only the first option
            optionsContainer.innerHTML = '';
            optionsContainer.appendChild(firstOption);
            
            // Ensure options container and buttons are visible
            optionsContainer.style.display = 'block';
            newQuestion.querySelector('.add-option').style.display = 'flex';
            newQuestion.querySelector('.remove-option').style.display = 'flex';
            
            // Remove any paragraph textarea if it exists
            const existingAnswer = newQuestion.querySelector('.answer-input');
            if (existingAnswer) {
                existingAnswer.remove();
            }
            
            
            // Insert the new question after the current one
            currentQuestion.insertAdjacentElement('afterend', newQuestion);

            // Update the option icons to show multiple choice
            updateOptionIcons(newQuestion.querySelector('.question-type'));
            
            // Disable remove option since it only has one option
            disableRemoveOption(newQuestion.querySelector('.remove-option'));
            
            // Update delete buttons
            updateDeleteButtons();
        }

        function duplicateQuestion() {
            const currentQuestion = event.target.closest('.question-block');
            const duplicatedQuestion = currentQuestion.cloneNode(true);
            
            // Preserve the values from the original question
            const originalTitle = currentQuestion.querySelector('.question-text').value;
            const originalType = currentQuestion.querySelector('.question-type').value;
            const originalDifficulty = currentQuestion.querySelector('.question-difficulty').value;
            
            duplicatedQuestion.querySelector('.question-text').value = originalTitle;
            duplicatedQuestion.querySelector('.question-type').value = originalType;
            duplicatedQuestion.querySelector('.question-difficulty').value = originalDifficulty;
            
            // Handle options based on question type
            if (originalType === 'paragraph') {
                const originalAnswer = currentQuestion.querySelector('.answer-input');
                if (originalAnswer) {
                    const newAnswer = duplicatedQuestion.querySelector('.answer-input');
                    if (newAnswer) {
                        newAnswer.value = originalAnswer.value;
                    }
                }
                // Hide options container and buttons for paragraph type
                duplicatedQuestion.querySelector('.options-container').style.display = 'none';
                duplicatedQuestion.querySelector('.add-option').style.display = 'none';
                duplicatedQuestion.querySelector('.remove-option').style.display = 'none';
            } else {
                // For multiple choice or checkbox questions, duplicate options
                const originalOptions = currentQuestion.querySelectorAll('.option-container');
                const duplicatedOptionsContainer = duplicatedQuestion.querySelector('.options-container');
                duplicatedOptionsContainer.innerHTML = ''; // Clear default options
                
                originalOptions.forEach(option => {
                    const duplicatedOption = option.cloneNode(true);
                    // Preserve option text and correct answer state
                    duplicatedOption.querySelector('.option-text').value = option.querySelector('.option-text').value;
                    duplicatedOption.querySelector('.correct-toggle').checked = option.querySelector('.correct-toggle').checked;
                    duplicatedOptionsContainer.appendChild(duplicatedOption);
                });
                
                // Update remove option button state
                const removeButton = duplicatedQuestion.querySelector('.remove-option');
                if (originalOptions.length <= 1) {
                    disableRemoveOption(removeButton);
                } else {
                    enableRemoveOption(removeButton);
                }
            }
            
            currentQuestion.insertAdjacentElement('afterend', duplicatedQuestion);
    
            // Ensure event listeners are properly set up for the new question
            updateOptionIcons(duplicatedQuestion.querySelector('.question-type'));
            // Enable delete buttons since we now have more than one question
            updateDeleteButtons();
        }

        function addOption(button) {
            const questionBlock = button.closest('.question-block');
            const optionsContainer = questionBlock.querySelector('.options-container');
            const newOption = optionsContainer.children[0].cloneNode(true);
            newOption.querySelector('.option-text').value = '';
            newOption.querySelector('.correct-toggle').checked = false;
            optionsContainer.appendChild(newOption);

            // Enable remove option button since we now have more than one option
            enableRemoveOption(questionBlock.querySelector('.remove-option'));
        }

        function removeOption(button) {
            const questionBlock = button.closest('.question-block');
            const optionsContainer = questionBlock.querySelector('.options-container');
            const removeButton = questionBlock.querySelector('.remove-option');
            
            if (optionsContainer.children.length > 1) {
                optionsContainer.removeChild(optionsContainer.lastChild);
                
                // Disable remove button if we're down to one option
                if (optionsContainer.children.length <= 1) {
                    disableRemoveOption(removeButton);
                }
            }
        }

        function disableRemoveOption(button) {
            button.style.opacity = '0.5';
            button.style.cursor = 'not-allowed';
            button.style.pointerEvents = 'none'; // This prevents clicking
        }

        function enableRemoveOption(button) {
            button.style.opacity = '1';
            button.style.cursor = 'pointer';
            button.style.pointerEvents = 'auto'; // This enables clicking
        }

        function updateOptionIcons(selectElement) {
            const questionBlock = selectElement.closest('.question-block');
            const optionIcons = questionBlock.querySelectorAll('.option-icon');
            
            const multipleChoiceIcon = `<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#2e3849">
                <path d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/>
            </svg>`;
            
            const checkboxIcon = `<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#2e3849">
                <path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Z"/>
            </svg>`;

            optionIcons.forEach(iconContainer => {
                iconContainer.innerHTML = selectElement.value === 'multiple-choice' ? multipleChoiceIcon : checkboxIcon;
            });
        }

      // Initialize the page and set up event listeners
        document.addEventListener('DOMContentLoaded', function() {
                // Disable all remove option buttons initially
                document.querySelectorAll('.remove-option').forEach(button => {
                    const questionBlock = button.closest('.question-block');
                    const optionsContainer = questionBlock.querySelector('.options-container');
                    
                    if (optionsContainer.children.length <= 1) {
                        disableRemoveOption(button);
                    }
                });

                // Initialize delete button states
                updateDeleteButtons();

                // Event listener for question type changes
    document.addEventListener('change', function(e) {
        if (e.target.classList.contains('question-type')) {
            const questionBlock = e.target.closest('.question-block');
            const optionsContainer = questionBlock.querySelector('.options-container'); 
            const addOptionButton = questionBlock.querySelector('.add-option');
            const removeOptionButton = questionBlock.querySelector('.remove-option');
            const difficultySelect = questionBlock.querySelector('.question-difficulty');

            // Set difficulty based on question type
            if (e.target.value === 'checkbox') {
                difficultySelect.value = 'intermediate';
            } else if (e.target.value === 'paragraph') {
                difficultySelect.value = 'difficult';
            }

            if (e.target.value === 'paragraph') {
                optionsContainer.style.display = 'none';
                addOptionButton.style.display = 'none';
                removeOptionButton.style.display = 'none';
                
                const answerInput = document.createElement('textarea');
                answerInput.className = 'answer-input';
                answerInput.placeholder = 'Enter long answer text';
                
                const existingAnswer = questionBlock.querySelector('.answer-input');
                if (existingAnswer) {
                    existingAnswer.remove();
                }
                
                const questionHeader = questionBlock.querySelector('.question-header');
                questionHeader.insertAdjacentElement('afterend', answerInput);
            } else {
                optionsContainer.style.display = 'block';
                addOptionButton.style.display = 'flex';
                removeOptionButton.style.display = 'flex';
                
                const answerInput = questionBlock.querySelector('.answer-input');
                if (answerInput) {
                    answerInput.remove();
                }
                
                updateOptionIcons(e.target);
            }
        }
    });
        });

    </script>
</body>
</html>